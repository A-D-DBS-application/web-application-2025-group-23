{% extends "base.html" %}
{% block title %}Ongoing Deal Detail – Barter.com{% endblock %}
{% block nav_tradeflow_active %}class="active"{% endblock %}
{% set active_page = 'ongoing' %}

{% block content %}
<div class="tradeflow-container">
    {% include '_tradeflow_sidebar.html' %}

    <main class="main">
      <a href="{{ url_for('main.tradeflow_ongoing_deals', company_id=company.company_id) }}" class="back-link">← Back to Deals</a>
      <div class="detail-card">
        <h1 class="tradeflow-header-title">Ongoing Deal</h1>
        <p class="tradeflow-header-subtitle">Track service delivery and confirm when received</p>
        
        <div class="pair-grid">
          <div class="pair-side">
            <div class="pair-label">{{ proposal.from_company.name }} provides</div>
            <div class="pair-service">{{ proposal.from_service.title }}</div>
            <div class="pair-desc">{{ proposal.from_service.description }}</div>
          </div>
          <div class="pair-side">
            <div class="pair-label">{{ proposal.to_company.name }} provides</div>
            <div class="pair-service">{{ proposal.to_service.title }}</div>
            <div class="pair-desc">{{ proposal.to_service.description }}</div>
          </div>
        </div>

        <div class="section-divider--top-mt24">
          <h2 class="delivery-section-title">Delivery Status</h2>
          <div class="status-grid">
            <div class="status-item">
              <div class="status-label">{{ proposal.from_company.name }} delivered?</div>
              <div class="status-value {% if active_deal.from_company_completed %}confirmed{% else %}pending{% endif %}">
                {% if active_deal.from_company_completed %}✓ Confirmed{% else %}⏳ Pending{% endif %}
              </div>
            </div>
            <div class="status-item">
              <div class="status-label">{{ proposal.to_company.name }} delivered?</div>
              <div class="status-value {% if active_deal.to_company_completed %}confirmed{% else %}pending{% endif %}">
                {% if active_deal.to_company_completed %}✓ Confirmed{% else %}⏳ Pending{% endif %}
              </div>
            </div>
          </div>

          {% set other_company_name = proposal.to_company.name if company.company_id == proposal.from_company_id else proposal.from_company.name %}
          {% set other_delivered = active_deal.to_company_completed if company.company_id == proposal.from_company_id else active_deal.from_company_completed %}
          
          {% if not other_delivered %}
          <div class="action-buttons">
            <form method="POST">
              <button type="submit" class="btn btn-success">Confirm {{ other_company_name }} Delivered</button>
            </form>
          </div>
          {% else %}
          <div class="delivery-success-box">
            <p class="delivery-success-text">✓ You've confirmed {{ other_company_name }} delivered their service</p>
          </div>
          {% endif %}
        </div>
      </div>
    </main>
  </div>
{% endblock %}
