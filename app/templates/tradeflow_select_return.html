{% extends "base.html" %}
{% block title %}Select Return Service ‚Äì Barter.com{% endblock %}

{% block content %}
<header class="header">
    <div class="logo">Barter.com</div>
    <nav class="nav-links">
      <a href="{{ url_for('main.select_company_for_marketplace') }}" class="nav-link">Marketplace</a>
      <a href="{{ url_for('main.my_companies') }}" class="nav-link">My companies</a>
      <a href="{{ url_for('main.logout') }}" class="nav-link">Log out</a>
    </nav>
  </header>
  <div class="container">
    <aside class="sidebar">
      <div class="company-badge">{{ company.name }}</div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-title">Requests</div>
        <a href="{{ url_for('main.tradeflow_incoming_requests', company_id=company.company_id) }}" class="sidebar-link">Incoming</a>
        <a href="{{ url_for('main.tradeflow_you_requested', company_id=company.company_id) }}" class="sidebar-link">You Requested</a>
        <a href="{{ url_for('main.tradeflow_archived_requests', company_id=company.company_id) }}" class="sidebar-link">Archived</a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-title">Contracts</div>
        <a href="{{ url_for('main.tradeflow_match_made', company_id=company.company_id) }}" class="sidebar-link">Matches</a>
        <a href="{{ url_for('main.tradeflow_awaiting_signature', company_id=company.company_id) }}" class="sidebar-link">Waiting for You</a>
        <a href="{{ url_for('main.tradeflow_awaiting_other_party', company_id=company.company_id) }}" class="sidebar-link">Awaiting Them</a>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-section-title">Deals</div>
        <a href="{{ url_for('main.tradeflow_ongoing_deals', company_id=company.company_id) }}" class="sidebar-link">Ongoing</a>
        <a href="{{ url_for('main.tradeflow_completed_deals', company_id=company.company_id) }}" class="sidebar-link">Completed</a>
      </div>
    </aside>

    <main class="main">
      <a href="{{ url_for('main.tradeflow_incoming_requests', company_id=company.company_id) }}" class="back-link">‚Üê Back to Incoming Requests</a>
      
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
        <div class="page-header" style="margin-bottom: 0;">
          <h1 class="page-title">Select return service</h1>
          <p class="page-desc">Select one of their services to create a potential trade match or decline request</p>
        </div>
        <form method="POST" action="{{ url_for('main.tradeflow_decline_request', company_id=company.company_id, request_id=incoming_request.request_id) }}" style="margin: 0;">
          <button type="submit" style="background: #e8eaed; color: #1a1a1a; padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; font-size: 14px; cursor: pointer; transition: background 0.2s;">Decline this request</button>
        </form>
      </div>

      <div style="background: #f5f7fa; padding: 16px 20px; border-radius: 8px; margin-bottom: 32px; border-left: 4px solid #1A73E8;">
        <div style="font-size: 13px; color: #5f6368; margin-bottom: 4px;">{{ incoming_request.requesting_company.name }} wants</div>
        <div style="font-size: 18px; font-weight: 600; color: #1a1a1a;">{{ incoming_request.requested_service.title }}</div>
        <div style="font-size: 13px; color: #5f6368; margin-top: 6px;">{{ incoming_request.requested_service.description[:100] }}{% if incoming_request.requested_service.description|length > 100 %}...{% endif %}</div>
      </div>

      {% if services %}
        <div class="cards-grid">
          {% for service in services %}
          <div class="card" onclick="location.href='{{ url_for('main.tradeflow_select_return_detail', company_id=company.company_id, request_id=incoming_request.request_id, service_id=service.service_id) }}'">
            <div class="card-title">{{ service.title }}</div>
            <div style="font-size: 12px; color: #9aa0a6; margin-bottom: 8px;">{{ company.name }}</div>
            <div class="card-desc">{{ service.description[:80] }}{% if service.description|length > 80 %}...{% endif %}</div>
            <div class="card-meta">
              <span>‚è± {{ service.duration_hours }} hrs</span>
              <span class="card-badge">{{ service.category or 'Service' }}</span>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
      <div class="empty">
        <div class="empty-icon">üö´</div>
        <div class="empty-text">You don't have any services yet. Create one first!</div>
      </div>
      {% endif %}

    </main>
  </div>
{% endblock %}
